// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = "mysql://root@localhost:3306/eduroute_bontang"
}

// --- ENUMS ---
enum SchoolType {
  SMA
  SMK
  MA
  SWASTA
}

enum RouteType {
  BUS_SEKOLAH
  ANGKOT
  JALAN_UTAMA
}

// --- GIS MODELS ---

model School {
  id          Int        @id @default(autoincrement())
  name        String     @unique @db.VarChar(100)
  type        SchoolType
  address     String?    @db.Text
  description String?    @db.Text

  // Spatial Data (Native MySQL Types with SRID 4326)
  location Unsupported("POINT")
  area     Unsupported("POLYGON")

  busRoutes BusRoute[] // Routes that serve this school

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("schools")
}

model BusStop {
  id          Int     @id @default(autoincrement())
  name        String  @db.VarChar(100)
  address     String? @db.Text
  description String? @db.Text

  // Spatial Data
  location Unsupported("POINT")
  area     Unsupported("POLYGON")

  generatedRoutes BusRoute[] // Relation to routes

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("bus_stops")
}

model BusRoute {
  id          Int     @id @default(autoincrement())
  name        String
  color       String  @db.VarChar(7)
  pathData    Json // GeoJSON LineString for the visual route
  schedule    Json? // Store schedule info e.g. { departure: "06:00", return: "14:00" }
  description String? @db.Text

  busStops BusStop[]
  schools  School[] // Schools served by this route

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("bus_routes")
}
